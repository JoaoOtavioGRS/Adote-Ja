{% extends "base.html" %}

{% block title %}
    {{ 'Editar Animal' if animal else 'Cadastrar Animal' }}
{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="mb-4 text-center">{{ 'Editar Animal' if animal else 'Cadastrar Animal' }}</h1>

    <div class="text-center mb-4">
        <div class="card border-primary shadow-sm">
            <div class="card-body">
                <h5 class="mb-1 text-info">Obrigado por ajudar um pet a encontrar um lar ❤️ </h5>
                <p class="mb-0">
                    Todos os anúncios são removidos automaticamente após <strong>30 dias</strong>.<br>
                    Caso o pet seja adotado antes desse prazo, você pode <strong>excluir o anúncio manualmente</strong>.
                </p>
            </div>
        </div>
    </div>

    <form method="POST" enctype="multipart/form-data" class="row g-3"
          action="{{ url_for('cadastrar_ou_editar_animal', id=animal.id if animal else None) }}">
        <div class="col-md-6">
            <label for="nome" class="form-label">Nome:</label>
            <input type="text" class="form-control" name="nome" value="{{ animal.nome if animal else '' }}" required>
        </div>

        <div class="col-md-6">
            <label for="especie" class="form-label">Espécie:</label>
            <select class="form-select select2" name="especie" id="especie" required>
                <option value="">Selecione</option>
                <option value="Cachorro" {% if animal and animal.especie == "Cachorro" %}selected{% endif %}>Cachorro</option>
                <option value="Gato" {% if animal and animal.especie == "Gato" %}selected{% endif %}>Gato</option>
            </select>
        </div>

        <div class="col-md-6">
            <label for="raca" class="form-label">Raça:</label>
            <select class="form-select select2" name="raca" id="raca" required></select>
        </div>

        <div class="col-md-6">
            <label for="sexo" class="form-label">Sexo:</label>
            <select class="form-select select2" name="sexo" required>
                <option value="">Selecione</option>
                <option value="Macho" {% if animal and animal.sexo == "Macho" %}selected{% endif %}>Macho</option>
                <option value="Fêmea" {% if animal and animal.sexo == "Fêmea" %}selected{% endif %}>Fêmea</option>
            </select>
        </div>

                <div class="col-md-6">
                    <label for="vacinado" class="form-label">Vacinado:</label>
                    <select class="form-select select2" name="vacinado" required>
                        <option value="2" {% if (animal and animal.vacinado == 2) or not animal %}selected{% endif %}>Não sei</option>
                        <option value="0" {% if animal and animal.vacinado == 0 %}selected{% endif %}>Sim</option>
                        <option value="1" {% if animal and animal.vacinado == 1 %}selected{% endif %}>Não</option>
                    </select>
                </div>

                <div class="col-md-6">
                    <label for="castrado" class="form-label">Castrado:</label>
                    <select class="form-select select2" name="castrado" required>
                        <option value="2" {% if (animal and animal.castrado == 2) or not animal %}selected{% endif %}>Selecione</option>
                        <option value="0" {% if animal and animal.castrado == 0 %}selected{% endif %}>Sim</option>
                        <option value="1" {% if animal and animal.castrado == 1 %}selected{% endif %}>Não</option>
                    </select>
                </div>


        <div class="col-md-6">
            <label for="foto" class="form-label">Foto do Animal:</label>
            {% if animal and animal.foto %}
                <div class="mb-2">
                    <img src="{{ url_for('static', filename='uploads/img_animais/' + animal.foto) }}" alt="Foto do animal" class="img-thumbnail" style="max-width: 150px;">
                </div>
            {% endif %}
            <input type="file" class="form-control" name="foto" accept="image/*">
        </div>

        <div class="col-12 d-grid">
            <button type="submit" class="btn btn-{{ 'primary' if animal else 'success' }}">
                {{ 'Salvar Alterações' if animal else 'Cadastrar' }}
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    const racas_cachorro = [
        "SRD Porte Pequeno", "SRD Porte Médio", "SRD Porte Grande", "Poodle",
        "Labrador Retriever", "Shih Tzu", "Pinscher", "Yorkshire Terrier",
        "Pastor Alemão", "Golden Retriever", "Bulldog Francês", "Bulldog Inglês",
        "Beagle", "Boxer", "Chow Chow", "Spitz Alemão (Lulu da Pomerânia)",
        "Border Collie", "Rottweiler", "Basset Hound", "Cocker Spaniel",
        "Maltês", "Dachshund (Salsicha)", "Pug", "Outros"
    ];

    const racas_gato = [
        "SRD", "Persa", "Siamês", "Maine Coon", "Angorá Turco", "Ragdoll",
        "Sphynx", "Bengal", "British Shorthair", "American Shorthair",
        "Abissínio", "Outros"
    ];

    function atualizarRacas(racaAtual = null) {
        const especie = document.getElementById("especie").value;
        const racaSelect = document.getElementById("raca");

        // limpa opções
        racaSelect.innerHTML = "";

        let racas = [];
        if (especie === "Cachorro") racas = racas_cachorro;
        else if (especie === "Gato") racas = racas_gato;

        // popula opções
        racas.forEach(raca => {
            const option = document.createElement("option");
            option.value = raca;
            option.text = raca;
            racaSelect.appendChild(option);
        });

        // seleciona a raça atual ou adiciona se não estiver na lista
        if (racaAtual) {
            if (!racas.includes(racaAtual)) {
                const option = document.createElement("option");
                option.value = racaAtual;
                option.text = racaAtual;
                racaSelect.appendChild(option);
            }
            racaSelect.value = racaAtual;
        }

        if ($(racaSelect).hasClass("select2-hidden-accessible")) {
            $(racaSelect).trigger("change");
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        const especieSelect = document.getElementById("especie");
        if (especieSelect) {
            // Atualiza raças com a raça do animal se houver
            atualizarRacas("{{ animal.raca if animal else '' }}");

            especieSelect.addEventListener("change", function () {
                atualizarRacas();
            });
        }
    });

</script>
{% endblock %}
