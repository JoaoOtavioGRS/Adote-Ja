{% extends "base.html" %}

{% block title %}
    {{ 'Editar Animal' if animal else 'Cadastrar Animal' }}
{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="mb-4 text-center">{{ 'Editar Animal' if animal else 'Cadastrar Animal' }}</h1>

    <div class="mb-4 text-start">
        <a href="{{ url_for('home') }}" class="btn btn-secondary">Voltar</a>
    </div>

    <form method="POST" enctype="multipart/form-data" class="row g-3"
          action="{{ url_for('cadastrar_ou_editar_animal', id=animal.id if animal else None) }}">
        <div class="col-md-6">
            <label for="nome" class="form-label">Nome:</label>
            <input type="text" class="form-control" name="nome" value="{{ animal.nome if animal else '' }}" required>
        </div>

        <div class="col-md-6">
            <label for="especie" class="form-label">Espécie:</label>
            <select class="form-select select2" name="especie" id="especie" required>
                <option value="">Selecione</option>
                <option value="Cachorro" {% if animal and animal.especie == "Cachorro" %}selected{% endif %}>Cachorro</option>
                <option value="Gato" {% if animal and animal.especie == "Gato" %}selected{% endif %}>Gato</option>
            </select>
        </div>

        <div class="col-md-6">
            <label for="raca" class="form-label">Raça:</label>
            <select class="form-select select2" name="raca" id="raca" required></select>
        </div>

        <div class="col-md-6">
            <label for="sexo" class="form-label">Sexo:</label>
            <select class="form-select select2" name="sexo" required>
                <option value="">Selecione</option>
                <option value="Macho" {% if animal and animal.sexo == "Macho" %}selected{% endif %}>Macho</option>
                <option value="Fêmea" {% if animal and animal.sexo == "Fêmea" %}selected{% endif %}>Fêmea</option>
            </select>
        </div>

        <div class="col-md-6">
            <label for="vacinado" class="form-label">Vacinado:</label>
            <select class="form-select select2" name="vacinado" required>
                <option value="">Selecione</option>
                <option value="0" {% if animal and animal.vacinado == 0 %}selected{% endif %}>Sim</option>
                <option value="1" {% if animal and animal.vacinado == 1 %}selected{% endif %}>Não</option>
                <option value="2" {% if animal and animal.vacinado == 2 %}selected{% endif %}>Não sei</option>
            </select>
        </div>

        <div class="col-md-6">
            <label for="castrado" class="form-label">Castrado:</label>
            <select class="form-select select2" name="castrado" required>
                <option value="">Selecione</option>
                <option value="0" {% if animal and animal.castrado == 0 %}selected{% endif %}>Sim</option>
                <option value="1" {% if animal and animal.castrado == 1 %}selected{% endif %}>Não</option>
                <option value="2" {% if animal and animal.castrado == 2 %}selected{% endif %}>Não sei</option>
            </select>
        </div>

        <div class="col-md-6">
            <label for="foto" class="form-label">Foto do Animal:</label>
            {% if animal and animal.foto %}
                <div class="mb-2">
                    <img src="{{ url_for('static', filename='uploads/img_animais/' + animal.foto) }}" alt="Foto do animal" class="img-thumbnail" style="max-width: 150px;">
                </div>
            {% endif %}
            <input type="file" class="form-control" name="foto" accept="image/*">
        </div>

        <div class="col-12 d-grid">
            <button type="submit" class="btn btn-{{ 'primary' if animal else 'success' }}">
                {{ 'Salvar Alterações' if animal else 'Cadastrar' }}
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>

    const racas_cachorro = ["SRD Porte Pequeno", "SRD Porte Medio", "SRD Porte Grande", "Poodle", "Labrador", "Shih Tzu", "Pinscher", "Yorkshire", "Pastor Alemão", "Golden Retriever", "Bulldog Francês", "Pitbull", "Outros"];
    const racas_gato = ["SRD", "Persa", "Siamês", "Maine Coon", "Angorá", "Outros"];

    function atualizarRacas() {
        const especie = $('#especie').val();
        let racas = [];

        if (especie === "Cachorro") {
            racas = racas_cachorro;
        } else if (especie === "Gato") {
            racas = racas_gato;
        }

        const $raca = $('#raca');
        $raca.empty().append('<option value="">Selecione</option>');
        racas.forEach(raca => {
            const selected = (raca === "{{ animal.raca if animal else '' }}") ? 'selected' : '';
            $raca.append(`<option value="${raca}" ${selected}>${raca}</option>`);
        });
        $raca.trigger('change');
    }

    $(document).ready(function() {
    $('.select2').select2({
    placeholder: "Selecione",
    allowClear: true,
    language: {
        noResults: function() {
            return "Nenhum resultado encontrado";
        },
        searching: function() {
            return "Buscando...";
        },
        inputTooShort: function() {
            return "Digite mais caracteres";
        }
    }
});
        $('#especie').on('change', atualizarRacas);
        atualizarRacas();
    });
</script>
{% endblock %}
