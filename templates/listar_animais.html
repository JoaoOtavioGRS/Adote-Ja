<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Listar Animais</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>
<body class="bg-light">
<div class="container py-5">
    <h1 class="mb-4 text-center">Animais Disponíveis para Adoção</h1>

    <div class="mb-4 text-start">
        <a href="{{ url_for('home') }}" class="btn btn-secondary">Voltar</a>
    </div>

    <form method="GET" class="row g-3 mb-4">
        <div class="col-md-3">
            <select class="form-select select2" name="especie" id="especie">
                <option value="">Espécie</option>
                <option value="Cachorro">Cachorro</option>
                <option value="Gato">Gato</option>
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-select select2" name="raca" id="raca">
                <option value="">Raça</option>
            </select>
        </div>
        <div class="col-md-2">
            <select class="form-select select2" name="sexo">
                <option value="">Sexo</option>
                <option value="Macho">Macho</option>
                <option value="Fêmea">Fêmea</option>
            </select>
        </div>
        <div class="col-md-2">
            <select class="form-select select2" name="vacinado">
                <option value="">Vacinado</option>
                <option value="Sim">Sim</option>
                <option value="Não">Não</option>
            </select>
        </div>
        <div class="col-md-2">
            <select class="form-select select2" name="castrado">
                <option value="">Castrado</option>
                <option value="Sim">Sim</option>
                <option value="Não">Não</option>
            </select>
        </div>
        <div class="col-md-12 d-grid">
            <button type="submit" class="btn btn-primary">Filtrar</button>
        </div>
    </form>

    <div class="row">
        {% for animal in animais %}
        <div class="col-md-4">
            <div class="card mb-4 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">{{ animal.nome }}</h5>
                    <p class="card-text"><strong>Espécie:</strong> {{ animal.especie }}</p>
                    <p class="card-text"><strong>Raça:</strong> {{ animal.raca }}</p>
                    <p class="card-text"><strong>Sexo:</strong> {{ animal.sexo }}</p>
                    <p class="card-text"><strong>Vacinado:</strong> {{ 'Sim' if animal.vacinado else 'Não' }}</p>
                    <p class="card-text"><strong>Castrado:</strong> {{ 'Sim' if animal.castrado else 'Não' }}</p>
                    <p class="card-text"><strong>Telefone para contato:</strong> {{ animal.usuario.telefone }}</p>
                </div>
            </div>
        </div>
        {% else %}
        <p class="text-center">Nenhum animal encontrado.</p>
        {% endfor %}
    </div>
</div>

<script>
    const racas_cachorro = ["SRD Porte Pequeno", "SRD Porte Médio", "SRD Porte Grande", "Poodle", "Labrador", "Shih Tzu", "Pinscher", "Yorkshire", "Pastor Alemão", "Golden Retriever", "Bulldog Francês", "Pitbull", "Outros"];
    const racas_gato = ["SRD", "Persa", "Siamês", "Maine Coon", "Angorá", "Outros"];

    function atualizarRacas() {
        const especie = $('#especie').val();
        let racas = [];

        if (especie === "Cachorro") {
            racas = racas_cachorro;
        } else if (especie === "Gato") {
            racas = racas_gato;
        }

        const $raca = $('#raca');
        $raca.empty().append('<option value="">Raça</option>');
        racas.forEach(raca => {
            $raca.append(`<option value="${raca}">${raca}</option>`);
        });
        $raca.trigger('change');
    }

    $(document).ready(function() {
        $('.select2').select2({
            placeholder: "Selecione",
            allowClear: true
        });

        $('#especie').on('change', atualizarRacas);

        // Preencher raças automaticamente se especie já selecionada
        atualizarRacas();
        const selectedRaca = "{{ request.args.get('raca', '') }}";
        if (selectedRaca) {
            $('#raca').val(selectedRaca).trigger('change');
        }
    });
</script>
</body>
</html>
